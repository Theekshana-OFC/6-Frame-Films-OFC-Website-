<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Comment System</title>
  <style>
    body {
      background: #0a0a0a;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .box {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      margin: 0 auto 30px auto;
      box-shadow: 0 0 10px red;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      background: #111;
      border: none;
      border-bottom: 2px solid red;
      color: white;
      margin-bottom: 10px;
      border-radius: 5px;
      box-sizing: border-box;
      resize: none;
      font-size: 16px;
    }
    button {
      background: red;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }
    button:hover {
      transform: scale(1.05);
    }
    .comment {
      background: #111;
      border-left: 5px solid red;
      padding: 10px;
      margin: 10px auto;
      max-width: 500px;
      border-radius: 5px;
      animation: slideRight 1s ease forwards;
      cursor: pointer;
      position: relative;
    }
    .reply-box {
      margin-top: 10px;
      display: none;
    }
    .reply {
      background: #222;
      border-left: 5px solid #990000;
      margin-top: 10px;
      padding: 8px;
      border-radius: 5px;
      font-size: 14px;
    }
    .reply-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .close-reply {
      background: transparent;
      color: white;
      border: none;
      font-size: 18px;
      margin-left: 10px;
      cursor: pointer;
    }
    @keyframes slideRight {
      0% { transform: translateX(-100%); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>

  <div class="box">
    <h2>ðŸ’¬ Leave a Comment</h2>
    <input type="text" id="name" placeholder="Your Name">
    <textarea id="comment" rows="4" placeholder="Your Comment"></textarea>
    <button onclick="postComment()">Post</button>
  </div>

  <div id="comments"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB9L3XQKBsJqY8cOzVdNumbVa4Vq8QaOhE",
      authDomain: "comments-system-e1416.firebaseapp.com",
      databaseURL: "https://comments-system-e1416-default-rtdb.firebaseio.com",
      projectId: "comments-system-e1416",
      storageBucket: "comments-system-e1416.appspot.com",
      messagingSenderId: "437571712889",
      appId: "1:437571712889:web:ed7e85b17d59404b55e1a8",
      measurementId: "G-045QNTPL8M"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function postComment() {
      const name = document.getElementById('name').value.trim();
      const comment = document.getElementById('comment').value.trim();
      if (!name || !comment) return alert("Fill in both fields!");

      const commentData = {
        name: name,
        comment: comment,
        timestamp: Date.now()
      };

      db.ref('comments').push(commentData);
      document.getElementById('name').value = '';
      document.getElementById('comment').value = '';
    }

    const commentsDiv = document.getElementById('comments');
    const shownReplyBoxes = {};

    function renderComments() {
      db.ref('comments').on('value', snapshot => {
        commentsDiv.innerHTML = '';
        const data = snapshot.val();
        if (!data) return;
        const entries = Object.entries(data).sort((a, b) => b[1].timestamp - a[1].timestamp);

        entries.forEach(([id, comment]) => {
          const div = document.createElement('div');
          div.className = 'comment';
          div.innerHTML = <strong>${comment.name}</strong><br>${comment.comment};

          const replyBox = createReplyBox(id);
          replyBox.style.display = shownReplyBoxes[id] ? 'block' : 'none';
          div.appendChild(replyBox);

          div.addEventListener('click', () => {
            if (!shownReplyBoxes[id]) {
              replyBox.style.display = 'block';
              shownReplyBoxes[id] = true;
            }
          });

          const replies = comment.replies || {};
          Object.values(replies).forEach(reply => {
            const replyDiv = document.createElement('div');
            replyDiv.className = 'reply';
            replyDiv.innerHTML = <strong>${reply.name}</strong>: ${reply.text};
            div.appendChild(replyDiv);
          });

          commentsDiv.appendChild(div);
        });
      });
    }

    function createReplyBox(commentId) {
      const box = document.createElement('div');
      box.className = 'reply-box';

      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Your Name';

      const textarea = document.createElement('textarea');
      textarea.rows = 2;
      textarea.placeholder = 'Reply...';

      const actions = document.createElement('div');
      actions.className = 'reply-actions';

      const sendBtn = document.createElement('button');
      sendBtn.textContent = 'Send';
      sendBtn.onclick = (e) => {
        e.stopPropagation();
        const name = input.value.trim();
        const text = textarea.value.trim();
        if (!name || !text) return alert('Fill all fields!');
        const reply = { name, text, timestamp: Date.now() };
        db.ref(comments/${commentId}/replies).push(reply);
        input.value = '';
        textarea.value = '';
      };

      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = 'âŒ';
      closeBtn.className = 'close-reply';
      closeBtn.onclick = (e) => {
        e.stopPropagation();
        box.style.display = 'none';
        shownReplyBoxes[commentId] = false;
      };

      actions.appendChild(sendBtn);
      actions.appendChild(closeBtn);
      box.appendChild(input);
      box.appendChild(textarea);
      box.appendChild(actions);

      return box;
    }

    renderComments();
  </script>
</body>
</html>
